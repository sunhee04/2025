# app.py (MBTI 16ê°œ + ê²€ìƒ‰ + ì•ˆì •ì  ì´ë¯¸ì§€ í‘œì‹œ)
# ì´ë¯¸ì§€: picsum.photosì˜ ì‹œë“œ ê¸°ë°˜ ì •ì  URLì„ ì‚¬ìš©í•´ í•­ìƒ ë¡œë”©ë˜ë„ë¡ êµ¬ì„±
#   - ì˜ˆ) https://picsum.photos/seed/ISTJ-íšŒê³„ì‚¬/800/500
#   - ê°™ì€ ì‹œë“œì— ëŒ€í•´ ì–¸ì œë‚˜ ê°™ì€ ì´ë¯¸ì§€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤(ì•ˆì •ì  í‘œì‹œ ëª©ì )

import urllib.parse
import streamlit as st
from typing import List, Dict

st.set_page_config(page_title="MBTI ê¸°ë°˜ ì§„ë¡œ ì¶”ì²œ", page_icon="ğŸ’¼", layout="wide")

# ------------------------------------------------------------
# ë°ì´í„°: 16ê°œ MBTI Ã— 5ê°œ ì§ì—…
# ------------------------------------------------------------
MBTI_JOBS: Dict[str, List[Dict[str, str]]] = {
    "ISTJ": [
        {"job": "íšŒê³„ì‚¬"},
        {"job": "ë°ì´í„° ë¶„ì„ê°€"},
        {"job": "êµ°ì¸"},
        {"job": "í’ˆì§ˆê´€ë¦¬ ì—”ì§€ë‹ˆì–´"},
        {"job": "í–‰ì • ê³µë¬´ì›"},
    ],
    "ISFJ": [
        {"job": "ê°„í˜¸ì‚¬"},
        {"job": "ì´ˆë“±êµì‚¬"},
        {"job": "ì‚¬íšŒë³µì§€ì‚¬"},
        {"job": "ë¹„ì„œ"},
        {"job": "ì‹¬ë¦¬ìƒë‹´ì‚¬"},
    ],
    "INFJ": [
        {"job": "ì‹¬ë¦¬í•™ì"},
        {"job": "ì‘ê°€"},
        {"job": "êµìœ¡ ì»¨ì„¤í„´íŠ¸"},
        {"job": "ì‚¬íšŒìš´ë™ê°€"},
        {"job": "ì˜ˆìˆ ê°€"},
    ],
    "INTJ": [
        {"job": "ì „ëµê¸°íšê°€"},
        {"job": "ë°ì´í„° ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸"},
        {"job": "ì—°êµ¬ì›"},
        {"job": "ê²½ì˜ ì»¨ì„¤í„´íŠ¸"},
        {"job": "ì‹œìŠ¤í…œ ì—”ì§€ë‹ˆì–´"},
    ],
    "ISTP": [
        {"job": "ì •ë¹„ì‚¬"},
        {"job": "íŒŒì¼ëŸ¿"},
        {"job": "ì†Œë°©ê´€"},
        {"job": "ê²½ì°°ê´€"},
        {"job": "ì‘ê¸‰êµ¬ì¡°ì‚¬"},
    ],
    "ISFP": [
        {"job": "íŒ¨ì…˜ ë””ìì´ë„ˆ"},
        {"job": "ì‚¬ì§„ì‘ê°€"},
        {"job": "ìš”ë¦¬ì‚¬"},
        {"job": "ìŒì•…ê°€"},
        {"job": "ì‹¤ë‚´ë””ìì´ë„ˆ"},
    ],
    "INFP": [
        {"job": "ì‘ê°€"},
        {"job": "ìƒë‹´ê°€"},
        {"job": "ë²ˆì—­ê°€"},
        {"job": "ë¹„ì˜ë¦¬ë‹¨ì²´ í™œë™ê°€"},
        {"job": "ì½˜í…ì¸  ê¸°íšì"},
    ],
    "INTP": [
        {"job": "ì—°êµ¬ì›"},
        {"job": "í”„ë¡œê·¸ë˜ë¨¸"},
        {"job": "ê³¼í•™ì"},
        {"job": "ë°œëª…ê°€"},
        {"job": "ë°ì´í„° ë¶„ì„ê°€"},
    ],
    "ESTP": [
        {"job": "ì˜ì—… ì „ë¬¸ê°€"},
        {"job": "ê¸°ì—…ê°€"},
        {"job": "ìŠ¤í¬ì¸  ì½”ì¹˜"},
        {"job": "ë§ˆì¼€íŒ… ì „ë¬¸ê°€"},
        {"job": "ì´ë²¤íŠ¸ ê¸°íšì"},
    ],
    "ESFP": [
        {"job": "ë°°ìš°"},
        {"job": "ê°€ìˆ˜"},
        {"job": "ì—¬í–‰ ê°€ì´ë“œ"},
        {"job": "MC"},
        {"job": "ì˜ì—… ë§¤ë‹ˆì €"},
    ],
    "ENFP": [
        {"job": "ê´‘ê³  ê¸°íšì"},
        {"job": "í™ë³´ ì „ë¬¸ê°€"},
        {"job": "ì‘ê°€"},
        {"job": "ì‹¬ë¦¬ ìƒë‹´ê°€"},
        {"job": "ì´ë²¤íŠ¸ í”Œë˜ë„ˆ"},
    ],
    "ENTP": [
        {"job": "ê¸°ì—…ê°€"},
        {"job": "ë§ˆì¼€íŒ… ë””ë ‰í„°"},
        {"job": "ë³€í˜¸ì‚¬"},
        {"job": "ë²¤ì²˜ íˆ¬ìì"},
        {"job": "ê¸°ìˆ  í˜ì‹ ê°€"},
    ],
    "ESTJ": [
        {"job": "í”„ë¡œì íŠ¸ ë§¤ë‹ˆì €"},
        {"job": "ê²½ì˜ì"},
        {"job": "êµ° ê°„ë¶€"},
        {"job": "í–‰ì •ê´€ë¦¬ì"},
        {"job": "ì˜ì—… ê´€ë¦¬ì"},
    ],
    "ESFJ": [
        {"job": "ê°„í˜¸ì‚¬"},
        {"job": "êµì‚¬"},
        {"job": "HR ë§¤ë‹ˆì €"},
        {"job": "ìƒë‹´ì‚¬"},
        {"job": "ì˜ì–‘ì‚¬"},
    ],
    "ENFJ": [
        {"job": "êµìœ¡ì"},
        {"job": "ë¦¬ë”ì‹­ ì½”ì¹˜"},
        {"job": "ì‚¬íšŒìš´ë™ê°€"},
        {"job": "ì‹¬ë¦¬ìƒë‹´ì‚¬"},
        {"job": "í™ë³´ ì „ë¬¸ê°€"},
    ],
    "ENTJ": [
        {"job": "ê²½ì˜ ì»¨ì„¤í„´íŠ¸"},
        {"job": "CEO"},
        {"job": "ë³€í˜¸ì‚¬"},
        {"job": "í”„ë¡œì íŠ¸ ë””ë ‰í„°"},
        {"job": "ë§ˆì¼€íŒ… ì „ëµê°€"},
    ],
}

# ------------------------------------------------------------
# ìœ í‹¸: ì§ì—…ëª…ê³¼ MBTIë¥¼ ì‹œë“œë¡œ ì‚¬ìš©í•´ 'í•­ìƒ í‘œì‹œë˜ëŠ”' ì´ë¯¸ì§€ URL ìƒì„±
# ------------------------------------------------------------

def img_url(mbti: str, job: str, w: int = 800, h: int = 500) -> str:
    seed = f"{mbti}-{job}"
    return f"https://picsum.photos/seed/{urllib.parse.quote(seed)}/{w}/{h}"


def normalize(s: str) -> str:
    return "".join(s.lower().split())


def filter_jobs(keyword: str):
    k = normalize(keyword)
    results = []
    for t, jobs in MBTI_JOBS.items():
        for item in jobs:
            if k in normalize(item["job"]):
                results.append({"type": t, "job": item["job"], "img": img_url(t, item["job"])})
    return results

# ------------------------------------------------------------
# ì‚¬ì´ë“œë°” ì•ˆë‚´
# ------------------------------------------------------------
with st.sidebar:
    st.header("ğŸ” ì‚¬ìš© ë°©ë²•")
    st.markdown(
        "- ë“œë¡­ë‹¤ìš´ì—ì„œ **MBTI**ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ìœ í˜• ì¶”ì²œ ì§ì—…ì´ ë³´ì—¬ìš”.\n"
        "- ìœ„ ê²€ìƒ‰ì°½ì— **ì§ì—…ëª…** ì¼ë¶€ë¥¼ ì…ë ¥í•˜ë©´ MBTIì™€ ë¬´ê´€í•˜ê²Œ ì „ì²´ì—ì„œ ê²€ìƒ‰ë¼ìš”.\n"
        "- ì´ë¯¸ì§€ëŠ” *picsum.photos* ì‹œë“œ ê¸°ë°˜ ì •ì  URLì„ ì‚¬ìš©í•´ ì•ˆì •ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤."
    )
    st.markdown("---")
    st.caption("êµìœ¡ìš© ë°ëª¨ì…ë‹ˆë‹¤. ì‹¤ì œ ì§„ë¡œ ê²°ì •ì€ í¥ë¯¸Â·ì—­ëŸ‰Â·í™˜ê²½ ë“±ì„ ì¢…í•© ê³ ë ¤í•˜ì„¸ìš”.")

# ------------------------------------------------------------
# í—¤ë” & ì…ë ¥
# ------------------------------------------------------------
st.title("ğŸ’¼ MBTI ê¸°ë°˜ ì§„ë¡œ ì¶”ì²œ")
st.caption("MBTI ì„±í–¥ê³¼ ì§ì—… ê°„ì˜ **ì¼ë°˜ì  ê²½í–¥**ì„ ë³´ì—¬ì£¼ëŠ” êµìœ¡ìš© ì˜ˆì‹œì…ë‹ˆë‹¤.")

col1, col2 = st.columns([1, 2])
with col1:
    selected_mbti = st.selectbox("MBTI ì„ íƒ", list(MBTI_JOBS.keys()), index=0)
with col2:
    keyword = st.text_input("ì§ì—…ëª… ê²€ìƒ‰ (ì˜ˆ: ë°ì´í„°, ê°„í˜¸, ë””ìì´ë„ˆ)", placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë¹„ì›Œë‘ì„¸ìš”")

# ------------------------------------------------------------
# ë°ì´í„° ì¤€ë¹„
# ------------------------------------------------------------
if keyword.strip():
    data = filter_jobs(keyword)
    header = f"ğŸ” ê²€ìƒ‰ ê²°ê³¼ ({len(data)}ê±´)"
else:
    data = [{"type": selected_mbti, "job": d["job"], "img": img_url(selected_mbti, d["job"]) } for d in MBTI_JOBS[selected_mbti]]
    header = f"ğŸ§­ {selected_mbti} ìœ í˜• ì¶”ì²œ ì§ì—…"

st.subheader(header)

# ------------------------------------------------------------
# ê²°ê³¼ ë Œë”ë§ (ì¹´ë“œí˜• 3ì—´)
# ------------------------------------------------------------
if not data:
    st.info("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í‚¤ì›Œë“œë¥¼ ì‹œë„í•´ ë³´ì„¸ìš”.")
else:
    cols = st.columns(3)
    for i, item in enumerate(data):
        with cols[i % 3]:
            with st.container(border=True):
                st.markdown(f"**[{item['type']}] {item['job']}**")
                st.image(item["img"], use_column_width=True)
                with st.popover("â„¹ï¸ ì„¤ëª…"):
                    st.write(
                        "ì´ ì§ì—…ì€ í•´ë‹¹ MBTIì˜ ì¼ë°˜ì ì¸ ê°•ì ê³¼ ë¹„êµì  ì˜ ë§ëŠ”ë‹¤ê³  ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤.\n"
                        "ì‹¤ì œ ì í•©ì„±ì€ ê°œì¸ì˜ ê²½í—˜Â·ì—­ëŸ‰Â·í¥ë¯¸ì— ë”°ë¼ í¬ê²Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤."
                    )

# ------------------------------------------------------------
# í‘¸í„°
# ------------------------------------------------------------
st.markdown("---")
st.caption("ì´ë¯¸ì§€ëŠ” picsum.photosì—ì„œ ì œê³µí•˜ëŠ” ëœë¤ ì´ë¯¸ì§€ì´ë©°, ì‹œë“œ ê³ ì •ìœ¼ë¡œ í•­ìƒ í‘œì‹œë©ë‹ˆë‹¤.")
